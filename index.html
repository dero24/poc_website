<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Search API Playground — DuckDuckGo / Bing / Google</title>
<style>
  :root{--bg:#0f1724;--panel:#0b1220;--muted:#94a3b8;--accent:#7c3aed;--card:#071126;--success:#10b981}
  body{margin:0;font-family:Inter,Segoe UI,system-ui,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,#071029 0%, #071126 50%, #081226 100%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
  .app{width:980px;max-width:98%;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.04);box-shadow:0 10px 30px rgba(2,6,23,0.6);border-radius:12px;overflow:hidden}
  header{padding:18px 22px;background:linear-gradient(90deg,rgba(124,58,237,0.12),transparent);display:flex;gap:12px;align-items:center}
  header h1{font-size:16px;margin:0}
  .grid{display:grid;grid-template-columns:340px 1fr;gap:18px;padding:18px}
  .panel{background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:8px}
  select,input[type="text"],textarea{width:100%;padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:inherit;font-size:14px}
  textarea{min-height:110px;resize:vertical}
  .row{display:flex;gap:8px;align-items:center}
  .small{font-size:12px;color:var(--muted)}
  .actions{display:flex;gap:8px;margin-top:10px}
  button{background:var(--accent);color:white;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
  .out{padding:14px;min-height:320px;display:flex;flex-direction:column;gap:12px}
  .response{white-space:pre-wrap;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);overflow:auto;max-height:540px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
  .meta{display:flex;justify-content:space-between;align-items:center}
  .chip{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:999px;font-size:13px;color:var(--muted)}
  .rimer{width:18px;height:18px;border-radius:50%;border:3px solid rgba(255,255,255,0.08);border-top-color:var(--accent);animation:none}
  .rimer.running{animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .footerpx;background:rgba(255,255,255,0.01);display:flex;justify-content:space-between;align-items:center;font-size:13px;color:var(--muted)}
  .row-compact{display:flex;gap:8px;align-items:center}
  .badge{background:rgba(255,255,255,0.03);padding:3px 8px;border-radius:6px;font-size:12px;color:var(--muted)}
  .example{font-size:13px;color:var(--muted);margin-top:10px}
  .error{color:#ffb4a2;background:rgba(255,80,80,0.06);padding:8px;border-radius:6px;border:1px solid rgba(255,80,80,0.06)}
  a.link{color:var(--accent);text-decoration:none}
</style>
</head>
<body>
  <div class="app" role="application">
    <header>
      <h1>Search API Playground — DuckDuckGo, Bing, Google, Proxy</h1>
      <div class="chip">Single-file demo</div>
    </header>

    <div class="grid">
      <div class="panel">
        <label for="source">Choose source</label>
        <select id="source" aria-label="source selector">
          <option value="duckduckgo">DuckDuckGo Instant Answer (free)</option>
          <option value="bing">Bing Web Search (requires key / proxy)</option>
          <option value="google">Google Programmable Search (requires key)</option>
          <option value="proxy">Generic Proxy Endpoint (your fetch proxy)</option>
        </select>

        <div style="height:12px"></div>

        <label for="apikey">API Key or Proxy Endpoint (paste full URL for proxy)</label>
        <input id="apikey" type="text" placeholder="Bing subscription key OR proxy URL (https://...)" />

        <label for="cx" style="margin-top:10px">Google CX / Search Engine ID (optional)</label>
        <input id="cx" type="text" placeholder="Google Programmable Search engine ID (cx)" />

        <label style="margin-top:12px">Prompt (user input)</label>
        <textarea id="prompt" placeholder="Enter a query or 'react component to fetch data'..."></textarea>

        <div style="height:10px"></div>

        <label class="row-compact"><input id="smartEnhance" type="checkbox" /> <span style="margin-left:8px">Enable Smart prompt enhancement (local)</span></label>

        <div class="actions">
          <button id="sendBtn">Send</button>
          <button id="clearBtn" class="ghost">Clear Output</button>
        </div>

        <div class="example">
          Example prompts: "react fetch example", "debounce input React", "python open file example"
        </div>
      </div>

      <div class="panel out">
        <div class="meta">
          <div>
            <strong>Response</strong>
            <div class="small">See raw result and code snippets below</div>
          </div>
          <div style="display:flex;gap:10px;align-items:center">
            <div id="rimer" class="rimer" title="request activity indicator" aria-hidden="true"></div>
            <div class="chip" id="statusChip">idle</div>
          </div>
        </div>

        <div id="messages" class="response" role="log" aria-live="polite"></div>

        <div id="infoRow" class="row" style="margin-top:6px">
          <div class="small" id="timing">—</div>
          <div style="flex:1"></div>
          <div id="note" class="small">Local smart enhancer: adds concise instruction to the prompt</div>
        </div>

        <div id="errorBox" style="display:none;margin-top:8px"></div>
      </div>
    </div>

    <div class="footer">
      <div class="small">Deployable single file. For Bing/Google you may need a server-side proxy to avoid CORS and to keep keys secret.</div>
      <div><span class="badge">Tip</span></div>
    </div>
  </div>

<script>
/*
  Single-file Search API Playground
  - Supports DuckDuckGo (direct JSON), Bing Web Search, Google Programmable Search, and a generic proxy.
  - For Bing/Google in production: use a server-side proxy to keep API keys secret and to resolve CORS.
  - The "Smart prompt enhancement" is local and optional; it modifies the prompt before sending.
*/

const $ = id => document.getElementById(id);
const sourceEl = $('source');
const apiKeyEl = $('apikey');
const promptEl = $('prompt');
const sendBtn = $('sendBtn');
const clearBtn = $('clearBtn');
const messages = $('messages');
const statusChip = $('statusChip');
const rimer = $('rimer');
const timing = $('timing');
const cxEl = $('cx');
const errorBox = $('errorBox');
const smartEnhanceEl = $('smartEnhance');

let requestStart = 0;

// Utility: set running indicator
function setRunning(r) {
  if (r) {
    rimer.classList.add('running');
    statusChip.textContent = 'running';
  } else {
    rimer.classList.remove('running');
    statusChip.textContent = 'idle';
  }
}

// Local "smart" enhancer: simple deterministic enhancement for clarity and code requests
function enhancePrompt(original) {
  // Keep enhancement short and generic. This runs locally and never sends your keys.
  const guide = "Provide a concise, well-formatted answer. If code, return a runnable snippet with minimal explanation and no extra commentary.";
  // If the user is clearly asking for code, hint for a code block
  const wantsCode = /\b(code|example|snippet|react|python|javascript|js|jsx)\b/i.test(original);
  if (wantsCode) {
    return `${original.trim()} ${guide}`;
  }
  return original.trim();
}

// Short helper to append text to the response area
function appendMessage(text, isError=false) {
  const node = document.createElement('div');
  node.textContent = text;
  if (isError) node.style.color = '#ffb4a2';
  messages.appendChild(node);
  messages.scrollTop = messages.scrollHeight;
}

// Clear UI
clearBtn.addEventListener('click', () => {
  messages.textContent = '';
  timing.textContent = '—';
  errorBox.style.display = 'none';
  errorBox.innerHTML = '';
});

// Main send action
sendBtn.addEventListener('click', async () => {
  errorBox.style.display = 'none';
  errorBox.innerHTML = '';
  messages.textContent = '';
  const rawPrompt = promptEl.value || '';
  if (!rawPrompt.trim()) {
    errorBox.style.display = 'block';
    errorBox.innerHTML = '<div class="error">Please enter a prompt to send.</div>';
    return;
  }

  const source = sourceEl.value;
  const apiKeyOrProxy = apiKeyEl.value.trim();
  const googleCx = cxEl.value.trim();

  const finalPrompt = smartEnhanceEl.checked ? enhancePrompt(rawPrompt) : rawPrompt.trim();

  setRunning(true);
  requestStart = performance.now();
  timing.textContent = 'requesting...';

  try {
    if (source === 'duckduckgo') {
      // DuckDuckGo Instant Answer API (free)
      // Direct call: https://api.duckduckgo.com/?q=...&format=json&no_html=1
      const url = `https://api.duckduckgo.com/?q=${encodeURIComponent(finalPrompt)}&format=json&no_html=1&skip_disambig=1`;
      appendMessage(`Requesting DuckDuckGo: ${url}`);
      const res = await fetch(url, {method:'GET'});
      if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
      const data = await res.json();
      // Present the most useful fields
      const out = [];
      if (data.AbstractText) out.push(`Abstract:\n${data.AbstractText}`);
      if (data.RelatedTopics && data.RelatedTopics.length) {
        const snippets = data.RelatedTopics.slice(0,6).map(t => (t.Text || t.Result || '').replace(/<\/?[^>]+(>|$)/g, ''));
        out.push(`Related Topics:\n- ${snippets.join('\n- ')}`);
      }
      if (data.AbstractURL) out.push(`Source: ${data.AbstractURL}`);
      if (out.length === 0) out.push(JSON.stringify(data,null,2));
      appendMessage(out.join('\n\n'));
    } else if (source === 'bing') {
      // Bing Web Search: Requires key. Best practice: call via server-side proxy.
      // Client usage below will succeed only if you supply a proxy endpoint that forwards the request,
      // or if your environment permits CORS and you provide subscription key in a secure way (not recommended).
      if (!apiKeyOrProxy) throw new Error('Bing requires a subscription key OR a proxy endpoint. Paste the proxy full URL in the API Key field.');
      // If user provided a proxy URL, call it; otherwise assume it's a direct Bing key (not recommended from browser)
      if (apiKeyOrProxy.startsWith('http')) {
        // Proxy expected to accept ?q=... and forward to Bing
        const url = `${apiKeyOrProxy}${apiKeyOrProxy.includes('?')? '&' : '?'}q=${encodeURIComponent(finalPrompt)}`;
        appendMessage(`Requesting via proxy: ${url}`);
        const res = await fetch(url, {method:'GET'});
        if (!res.ok) throw new Error(`Proxy HTTP ${res.status} ${res.statusText}`);
        const payload = await res.json();
        appendMessage(JSON.stringify(payload, null, 2));
      } else {
        // Direct call attempt (will usually fail due to CORS and exposing key)
        appendMessage('Attempting direct Bing Web Search (not recommended from browser).');
        const endpoint = `https://api.bing.microsoft.com/v7.0/search?q=${encodeURIComponent(finalPrompt)}`;
        const res = await fetch(endpoint, {
          headers: { 'Ocp-Apim-Subscription-Key': apiKeyOrProxy }
        });
        if (!res.ok) throw new Error(`Bing HTTP ${res.status} ${res.statusText}`);
        const payload = await res.json();
        appendMessage(JSON.stringify(payload, null, 2));
      }
    } else if (source === 'google') {
      // Google Programmable Search (Custom Search JSON API)
      // Requires API key and cx. Browser calls may hit CORS and will expose the key.
      if (!apiKeyOrProxy || !googleCx) throw new Error('Google requires an API key (paste in API Key field) and a search engine ID (cx).');
      // User provided key in apiKeyOrProxy variable
      const endpoint = `https://www.googleapis.com/customsearch/v1?key=${encodeURIComponent(apiKeyOrProxy)}&cx=${encodeURIComponent(googleCx)}&q=${encodeURIComponent(finalPrompt)}`;
      appendMessage(`Requesting Google Programmable Search...`);
      const res = await fetch(endpoint);
      if (!res.ok) throw new Error(`Google HTTP ${res.status} ${res.statusText}`);
      const payload = await res.json();
      // Extract useful parts
      const items = payload.items || [];
      if (items.length === 0) {
        appendMessage('No items returned. Full payload:\n' + JSON.stringify(payload, null, 2));
      } else {
        const out = items.slice(0,6).map(it => `Title: ${it.title}\nLink: ${it.link}\nSnippet: ${it.snippet}`).join('\n\n---\n\n');
        appendMessage(out);
      }
    } else if (source === 'proxy') {
      // Generic proxy: the proxy should accept ?q=... and return JSON.
      if (!apiKeyOrProxy || !apiKeyOrProxy.startsWith('http')) throw new Error('Provide a full proxy URL in the API Key field, e.g. https://myproxy.example/search');
      const url = `${apiKeyOrProxy}${apiKeyOrProxy.includes('?')? '&' : '?'}q=${encodeURIComponent(finalPrompt)}`;
      appendMessage(`Requesting proxy: ${url}`);
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Proxy HTTP ${res.status} ${res.statusText}`);
      const payload = await res.json();
      appendMessage(JSON.stringify(payload, null, 2));
    } else {
      throw new Error('Unknown source selection.');
    }

    const totalMs = Math.round(performance.now() - requestStart);
    timing.textContent = `completed in ${totalMs} ms`;
  } catch (err) {
    const elapsed = Math.round(performance.now() - requestStart);
    timing.textContent = `error after ${elapsed} ms`;
    errorBox.style.display = 'block';
    errorBox.innerHTML = `<div class="error">Error: ${String(err.message || err)}</div>`;
  } finally {
    setRunning(false);
  }
});

// Small UX: press Ctrl+Enter to send
promptEl.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
    sendBtn.click();
  }
});

// Example: prefill prompt for quick testing
promptEl.value = "react fetch data example: simple component that fetches JSON and displays list";

</script>
</body>
</html>
