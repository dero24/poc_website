<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Morphic Web ‚Äî AI Agent Workflow</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
<style>
    html, body { 
      height: 100%; 
      overflow-x: hidden;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(122deg, #2435f7 0%, #9e7cea 85%);
      min-height: 100vh;
      background-attachment: fixed;
      color: #182042;
      margin: 0; padding: 0;
    }
    .container {
      max-width: 100vw;
      width: 95%;
      max-width: 700px;
      margin: 32px auto 20px;
      background: rgba(255,255,255,0.90);
      border-radius: 22px;
      box-shadow: 0 12px 36px 0 rgba(60,50,200,0.13);
      padding: 20px;
      backdrop-filter: blur(9px);
      position: relative;
      box-sizing: border-box;
    }
    
    .generated-content {
      margin-top: 12px;
      padding: 14px 10px 20px 10px;
      background: rgba(245,250,255,0.94);
      border-radius: 10px;
      min-height: 78px;
      max-width: 100%;
      overflow-x: auto;
      overflow-y: auto;
      box-sizing: border-box;
      word-wrap: break-word;
    }
    
    .generated-content * {
      max-width: 100% !important;
      box-sizing: border-box !important;
    }
    
    .generated-content div,
    .generated-content #mainAPP,
    .generated-content .mainAPP {
      max-width: 100% !important;
      overflow-x: auto !important;
      word-wrap: break-word !important;
      box-sizing: border-box !important;
    }
    
    .generated-content input,
    .generated-content textarea,
    .generated-content button,
    .generated-content table {
      max-width: 100% !important;
      box-sizing: border-box !important;
    }
    
    .generated-content table {
      width: 100% !important;
      table-layout: fixed !important;
    }

    .react-enhancement {
      margin-top: 15px;
      padding: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      color: white;
      text-align: center;
    }
    
    .react-enhancement button {
      background: rgba(255,255,255,0.9);
      color: #667eea;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      margin: 5px;
    }
    
    .react-enhancement button:hover {
      background: white;
    }
    
    .header {text-align:center;margin-bottom:22px;}
    .logo {font-size:2.1em;color:#5857f8;font-weight:900; text-shadow:0 0 12px #dbeafe;}
    .slogan {font-size:1.11em;opacity:.88;color:#4f40b5;margin:11px auto 0;text-align:center;}
    .agent-status {font-size:0.9em;color:#6b7280;margin-top:5px;font-style:italic;}
    .setup-card, .interaction-zone {margin-bottom:16px;}
    .api-input-group label{font-size:1.07em;font-weight:700;color:#7b64e7;display:block;margin-bottom:7px;}
    .api-input-group input{
      font-size:1.07em;padding:12px;width:95%;max-width:340px;border:2.1px solid #e3eafe;
      border-radius:11px;outline:none;margin-bottom:6px; background:rgba(255,255,255,0.6);
      box-shadow:0 2px 9px #b6bffb12 inset;
    }
    .api-input-group small{color:#6b7fa7;font-size:0.97em;margin-bottom:7px;display:block;}
    .start-btn {padding:12px 46px;border-radius:10px;font-size:1.07em;font-weight:700;background:linear-gradient(101deg,#524bb5 0%,#a5b4fc 80%);color:#fff;border:none;cursor:pointer;}
    .start-btn:hover{background:#7b64e7;}
    .stats {display:flex;gap:13px;margin-bottom:9px;flex-wrap:wrap;}
    .stat-card {flex:1;min-width:120px;padding:8px 3px;background:linear-gradient(91deg,#8bb2fe 10%,#add2fb 90%);color:#4027ba;border-radius:9px;text-align:center;font-weight:800;box-shadow:0 2px 7px #0001;}
    .stat-card h3{margin:0;font-size:1.15em;}
    .stat-card p{margin:2px 0 0;opacity:.81;font-size:.97em;}
    .user-input-area{margin-bottom:8px;display:flex;gap:9px;flex-wrap:wrap;}
    .user-input-area textarea {
      flex:1;min-width:250px;padding:13px 16px;border-radius:11px;min-height:50px;font-size:1.07em;
      border:2.1px solid #dadcff;background:#fbfbff;box-shadow:0 1.2px 9px #a9aaff10 inset;
      font-weight:600;letter-spacing:.01em;resize:vertical;
    }
    .user-input-area textarea:focus {border-color:#7b64e7;}
    .generate-btn {background:linear-gradient(89deg,#6267eb 12%,#4ee5fd 95%);color:white;border:none;padding:11px 17px;border-radius:11px;font-size:1.1em;font-weight:900;cursor:pointer;}
    .generate-btn:hover {background:#5ec6fb;}
    .loading{text-align:center;padding:10px;color:#7b64e7;font-size:1.11em;}
    .error-message{background:#f84a77;color:#fff;padding:9px 13px;border-radius:7px;margin-top:7px;}
    .branding{text-align:center;font-size:.94em;color:#7476af;margin-top:16px;}
    .history-log{margin-top:9px;padding:6px 8px;background:#f7f8fc;border-radius:8px;max-height:65px;overflow-y:auto;border:1.2px solid #e5e5fd;}
    .history-item{padding:4px 9px 3px 8px;margin-bottom:3px;background:#fff9;border-radius:5px;font-size:1em;border:1px solid #dfdbff;}
    
    @media(max-width:900px){
      .container{width:98%;padding:15px;}
      .stats{flex-direction:column;gap:4px;}
      .user-input-area{flex-direction:column;}
      .user-input-area textarea{min-width:100%;}
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">Morphic Web</div>
    <div class="slogan">AI Agent Workflow - Multi-step reasoning for complex apps</div>
    <div class="agent-status">3-step chain: Architecture ‚Üí Components ‚Üí Logic</div>
  </div>
  <div class="setup-card" id="setupCard">
    <form id="setupForm">
      <div class="api-input-group">
        <label for="apiKey">Groq API Key</label>
        <input type="password" id="apiKey" required autocomplete="off" placeholder="Paste your Groq API key">
        <small>Get a free key from <a href="https://console.groq.com/" target="_blank">console.groq.com</a></small>
      </div>
      <button type="submit" class="start-btn">üîì Start Morphic Web</button>
    </form>
  </div>
  <div style="display:none" class="interaction-zone" id="interactionZone">
    <div class="stats">
      <div class="stat-card"><h3 id="interactionCount">0</h3><p>Interactions</p></div>
      <div class="stat-card"><h3 id="elementsCreated">0</h3><p>Elements Created</p></div>
      <div class="stat-card"><h3 id="adaptations">0</h3><p>Adaptations</p></div>
    </div>
    <div class="user-input-area">
      <textarea id="userIntent" placeholder="Describe your app: game, dashboard, AI tool, etc. Everything will fit perfectly on your screen!"></textarea>
      <button type="button" onclick="generateInterface()" class="generate-btn">‚ú® Generate</button>
    </div>
    <div class="generated-content" id="generatedContent">
      <p style="color:#68a;text-align:center;">Your responsive app will appear here!</p>
    </div>
    <div id="reactEnhancement" style="display:none;" class="react-enhancement">
      <p><strong>‚ú® React Enhancement Available</strong></p>
      <button onclick="enhanceWithReact()">Upgrade to React Version</button>
      <button onclick="keepCurrentVersion()">Keep Current Version</button>
    </div>
    <div class="history-log" id="historyLog"></div>
  </div>
  <div class="branding">Morphic Web &copy; 2026 | Always Responsive</div>
</div>
<script>
let groqKey="", interactionCount=0, elementsCreated=0, adaptations=0, conversationHistory=[];
let currentAppCode = "";

function updateStats() {
  document.getElementById('interactionCount').textContent = interactionCount;
  document.getElementById('elementsCreated').textContent = elementsCreated;
  document.getElementById('adaptations').textContent = adaptations;
}

function logHistory(msg) {
  const log = document.getElementById('historyLog'), item = document.createElement('div');
  item.className = 'history-item'; item.textContent = `${new Date().toLocaleTimeString()} - ${msg}`;
  log.appendChild(item); log.scrollTop = log.scrollHeight;
}

function initializeExperience(e) {
  if(e) e.preventDefault();
  
  groqKey = document.getElementById('apiKey').value.trim();
  if(!groqKey) { 
    alert('Please paste your Groq API key!'); 
    return false;
  }
  
  window.groqKey = groqKey;
  document.getElementById('setupCard').style.display="none";
  document.getElementById('interactionZone').style.display="block";
  logHistory('üöÄ Session started - Ready to build amazing apps!');
  
  setTimeout(() => {
    document.getElementById('interactionZone').scrollIntoView({ behavior: 'smooth' });
  }, 100);
  
  return false;
}

async function generateInterface() {
  const intent=document.getElementById('userIntent').value.trim();
  const content=document.getElementById('generatedContent');
  const reactEnhancement=document.getElementById('reactEnhancement');
  
  if(!intent){alert('Please describe what you want to build!');return;}
  
  content.innerHTML='<div class="loading">‚ö°Ô∏è Creating your amazing app...</div>';
  reactEnhancement.style.display = 'none';
  interactionCount++; updateStats();
  
  try {
    content.innerHTML = '<div class="loading">üèóÔ∏è Step 1/3: Designing comprehensive architecture...</div>';
    
    const architecturePrompt = `USER REQUIREMENT: "${intent}"

Create a detailed technical architecture specification in plain text format. Be thorough and comprehensive.

Include these sections with detailed explanations:

1. DATA MODEL & STATE MANAGEMENT:
   - All state variables needed with their types and initial values
   - Data structures (objects, arrays, etc.) with their properties
   - Data flow patterns and how state will be updated
   - Any localStorage or sessionStorage needs

2. COMPONENT HIERARCHY & UI STRUCTURE:
   - Complete list of UI components from parent to child
   - Layout structure and how components relate to each other
   - Responsive breakpoints and mobile-first considerations
   - Accessibility features to include

3. USER INTERACTIONS & EVENT HANDLERS:
   - Every user action that needs handling (clicks, inputs, submits, etc.)
   - Event handler names and what they should do
   - Form validation requirements
   - Real-time updates or dynamic content changes

4. VISUAL DESIGN & STYLING:
   - Color scheme and theme
   - Typography choices
   - Spacing and layout approach
   - Animations or transitions needed

5. FUNCTIONALITY & FEATURES:
   - Core features that must work perfectly
   - Edge cases to handle
   - Error states and user feedback
   - Loading states

6. EXTERNAL DEPENDENCIES (if needed):
   - Any APIs to integrate
   - External libraries or CDNs
   - Data sources

Be detailed and specific. Take 400-500 words to fully plan this application.`;
    
    const architecture = await callGroqAPI(architecturePrompt, false);
    
    content.innerHTML='<div class="loading">‚öôÔ∏è Step 2/3: Building beautiful, functional components...</div>';
    const componentsPrompt = `CRITICAL INSTRUCTIONS - READ CAREFULLY:

YOU MUST OUTPUT COMPLETE, VALID HTML CODE ONLY. 
NO MARKDOWN CODE BLOCKS (no triple backtick html or triple backticks)
NO EXPLANATORY TEXT BEFORE OR AFTER THE CODE
START DIRECTLY WITH HTML TAGS

ARCHITECTURE SPECIFICATION:
${architecture}

USER'S ORIGINAL REQUEST: "${intent}"

YOUR MISSION: Create an absolutely AMAZING, fully-functional, beautiful application that will delight the user.

STRICT REQUIREMENTS - FOLLOW ALL OF THESE:

1. STRUCTURE & COMPLETENESS:
   - Create a complete, self-contained application
   - Include a <style> tag with comprehensive CSS
   - Include a <script> tag with all JavaScript functionality
   - Everything must work without external dependencies (unless specified in architecture)

2. RESPONSIVE DESIGN (CRITICAL):
   - Mobile-first approach - test at 320px width minimum
   - ALL containers: max-width: 100%; box-sizing: border-box;
   - NO fixed widths over 500px anywhere
   - Use flexbox with flex-wrap for all layouts
   - Use responsive units (%, rem, em, vw, vh)
   - Add proper meta viewport tag considerations

3. FUNCTIONALITY (MUST BE PERFECT):
   - Implement EVERY feature mentioned in the user's request
   - Add ALL necessary event handlers (onclick, onchange, oninput, onsubmit, etc.)
   - Make every button, input, and interactive element functional
   - Include proper form validation where needed
   - Add error handling for edge cases
   - Include loading states for any async operations

4. VISUAL DESIGN (MAKE IT BEAUTIFUL):
   - Use a cohesive, modern color scheme
   - Add proper spacing, padding, and margins
   - Include hover effects and transitions
   - Use modern CSS features (gradients, shadows, border-radius)
   - Ensure great typography and readability
   - Add visual feedback for all interactions

5. CODE QUALITY:
   - Write clean, organized, well-structured code
   - Use semantic HTML5 elements
   - Add helpful comments for complex logic
   - Use meaningful variable and function names
   - Ensure all functions are properly defined and called

6. USER EXPERIENCE:
   - Make the app intuitive and easy to use
   - Provide clear user feedback for all actions
   - Include helpful placeholders and labels
   - Handle empty states gracefully
   - Add success messages where appropriate

OUTPUT FORMAT (CRITICAL):
- Start IMMEDIATELY with <div> or <style> tag
- NO triple backtick markdown code blocks
- NO explanatory text
- Just pure, working HTML/CSS/JavaScript code
- Make it production-ready and impressive!`;
    
    const componentsHtml = await callGroqAPI(componentsPrompt, true);
    
    content.innerHTML='<div class="loading">‚ú® Step 3/3: Adding polish and perfecting interactions...</div>';
    const logicPrompt = `CRITICAL INSTRUCTIONS:

OUTPUT ONLY ENHANCED HTML CODE - NO MARKDOWN, NO EXPLANATIONS.

CURRENT WORKING CODE:
${componentsHtml}

USER'S ORIGINAL REQUEST: "${intent}"

YOUR MISSION: Take this already good code and make it EXCEPTIONAL.

ENHANCEMENT CHECKLIST - VERIFY AND IMPROVE ALL:

1. INTERACTION PERFECTION:
   - Test every single interactive element mentally
   - Ensure ALL event handlers are properly attached and functional
   - Add any missing onclick, onchange, oninput, onsubmit handlers
   - Verify form submissions work correctly
   - Check that buttons actually do what they should

2. ERROR HANDLING & EDGE CASES:
   - Add try-catch blocks for any operations that could fail
   - Validate user inputs before processing
   - Handle empty states and invalid data gracefully
   - Show helpful error messages to users
   - Prevent common errors (divide by zero, empty arrays, null values, etc.)

3. USER FEEDBACK & POLISH:
   - Add loading indicators for any delayed operations
   - Include success messages for completed actions
   - Add subtle animations and transitions
   - Ensure all user actions provide immediate visual feedback
   - Polish the overall user experience

4. RESPONSIVE REFINEMENT:
   - Double-check max-width: 100% on ALL elements
   - Ensure perfect mobile experience (320px width)
   - Test flexbox wrapping at different screen sizes
   - Verify no horizontal scrolling occurs
   - Check that touch targets are appropriately sized

5. PERFORMANCE & OPTIMIZATION:
   - Remove any duplicate code
   - Optimize event listeners
   - Ensure efficient DOM manipulation
   - Clean up any unused CSS or JavaScript

6. FINAL QUALITY CHECK:
   - Verify the app does EXACTLY what the user requested
   - Ensure professional appearance and smooth operation
   - Check that all features work together harmoniously
   - Make sure it's something users will love

CRITICAL OUTPUT REQUIREMENTS:
- Start DIRECTLY with HTML tags (like <div> or <style>)
- NO triple backtick html or triple backtick markdown blocks
- NO explanatory text before or after
- Just the complete, enhanced, production-ready code
- Make it absolutely amazing!`;
    
    const finalHtml = await callGroqAPI(logicPrompt, true);
    
    currentAppCode = finalHtml;
    parseAndInjectHTML(finalHtml, content);
    ensureResponsive();
    
    const shouldEnhance = await checkForReactEnhancement(intent, finalHtml);
    if (shouldEnhance) {
      reactEnhancement.style.display = 'block';
    }
    
    setTimeout(()=>content.scrollIntoView({behavior:'smooth',block:'center'}), 100);
    conversationHistory.push(intent);
    elementsCreated+=countElements(finalHtml); adaptations++;
    updateStats(); 
    logHistory(`‚ú® Created amazing app: "${intent.substring(0,40)}..."`);
    document.getElementById('userIntent').value='';
  } catch(e) {
    content.innerHTML=`<div class='error-message'><b>Error:</b> ${e.message}</div>`;
    logHistory(`‚ö†Ô∏è ${e.message}`);
  }
}

async function checkForReactEnhancement(intent, currentCode) {
  const complexPatterns = [
    /calculator|counter|timer|stopwatch/i,
    /todo|list|task|manager/i,
    /game|puzzle|quiz|trivia/i,
    /dashboard|analytics|chart|graph/i,
    /form|survey|questionnaire/i,
    /interactive|dynamic|real.?time/i
  ];
  
  return complexPatterns.some(pattern => pattern.test(intent));
}

async function enhanceWithReact() {
  const content = document.getElementById('generatedContent');
  const reactEnhancement = document.getElementById('reactEnhancement');
  
  content.innerHTML = '<div class="loading">‚ö°Ô∏è Upgrading to React architecture...</div>';
  reactEnhancement.style.display = 'none';
  
  try {
    const enhancementPrompt = `CRITICAL: OUTPUT COMPLETE HTML WITH REACT CODE ONLY. NO MARKDOWN, NO EXPLANATIONS.

Convert this application to use modern React architecture with hooks and functional components.

CURRENT APP CODE:
${currentAppCode}

REACT CONVERSION REQUIREMENTS:

1. Use React 18 with functional components and hooks
2. Include React and ReactDOM from CDN (unpkg or cdnjs)
3. Use useState for all state management
4. Use useEffect for side effects if needed
5. Properly structure components (can be multiple components)
6. Keep ALL existing functionality - nothing should be lost
7. Keep ALL existing styling - maintain the visual design
8. Ensure perfect responsive design (max-width: 100%)
9. Use createRoot for mounting (React 18 syntax)
10. Make it work flawlessly

OUTPUT FORMAT:
- Complete HTML file with React CDN script tags
- Start directly with <!DOCTYPE html> or HTML tags
- NO triple backtick html or triple backticks markdown blocks
- NO explanatory text
- Just working, production-ready React code`;
    
    const reactHtml = await callGroqAPI(enhancementPrompt, true);
    currentAppCode = reactHtml;
    parseAndInjectHTML(reactHtml, content);
    ensureResponsive();
    
    adaptations++;
    updateStats();
    logHistory('üîÑ Successfully upgraded to React!');
  } catch(e) {
    content.innerHTML = `<div class='error-message'><b>React upgrade failed:</b> ${e.message}</div>`;
    logHistory(`‚ö†Ô∏è React upgrade failed: ${e.message}`);
    parseAndInjectHTML(currentAppCode, content);
  }
}

function keepCurrentVersion() {
  document.getElementById('reactEnhancement').style.display = 'none';
  logHistory('‚úÖ Kept current version');
}

function ensureResponsive() {
  const content = document.getElementById('generatedContent');
  const allElements = content.querySelectorAll('*');
  
  allElements.forEach(el => {
    if (!el.style.maxWidth) el.style.maxWidth = '100%';
    if (!el.style.boxSizing) el.style.boxSizing = 'border-box';
    
    if (el.tagName === 'TABLE') {
      el.style.width = '100%';
      el.style.tableLayout = 'fixed';
    }
    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
      if (!el.style.width) el.style.width = '100%';
      el.style.maxWidth = '100%';
    }
  });
}

async function callGroqAPI(prompt, validateHTML = true) {
  const headers = new Headers();
  headers.append('Authorization', `Bearer ${groqKey}`);
  headers.append('Content-Type', 'application/json; charset=utf-8');
  
  const resp = await fetch('https://api.groq.com/openai/v1/chat/completions', {
    method: 'POST',
    headers: headers,
    body: JSON.stringify({
      model: 'llama-3.3-70b-versatile',
      max_tokens: 4096, 
      temperature: 0.8,
      messages: [{ role: "user", content: prompt }]
    })
  });
  
  if(!resp.ok){
    let errorMsg = "Groq API error";
    try { 
      const data = await resp.json(); 
      errorMsg = data.error?.message || errorMsg; 
    } catch(e) {
      console.error("Error parsing error response:", e);
    }
    throw new Error(errorMsg);
  }
  
  const data = await resp.json();
  let content = "";
  
  if (data.choices && data.choices[0]?.message?.content) {
    try {
      content = new TextDecoder('utf-8').decode(
        new TextEncoder().encode(data.choices[0].message.content.trim())
      );
    } catch(e) {
      console.error("Encoding error:", e);
      content = data.choices[0].message.content.trim();
    }
  }
  
  content = content.replace(/``````javascript|```
  
  if (validateHTML) {
    const hasValidContent = content && (
      /<div/i.test(content) || 
      /<button/i.test(content) ||
      /<input/i.test(content) ||
      /<form/i.test(content) ||
      /<table/i.test(content) ||
      /<canvas/i.test(content) ||
      /<style/i.test(content) ||
      /<!DOCTYPE/i.test(content)
    );
    
    if(!hasValidContent) {
      console.log("Raw response:", data.choices[0]?.message?.content);
      throw new Error("No usable HTML generated - AI returned invalid format");
    }
  }
  
  return content;
}

function parseAndInjectHTML(raw, container) {
  let html = raw;
  
  const styleClosing = '<' + '/' + 'style>';
  const scriptClosing = '<' + '/' + 'script>';
  
  const stylePattern = new RegExp('<style[^>]*>([\\s\\S]*?)' + styleClosing, 'i');
  const styleMatch = html.match(stylePattern);
  const styleContent = styleMatch ? styleMatch[1] : "";
  html = html.replace(new RegExp('<style[^>]*>[\\s\\S]*?' + styleClosing, 'gi'), "");
  
  const scriptPattern = new RegExp('<script[^>]*>([\\s\\S]*?)' + scriptClosing, 'i');
  const scriptMatch = html.match(scriptPattern);
  const scriptContent = scriptMatch ? scriptMatch[1] : "";
  html = html.replace(new RegExp('<script[^>]*>[\\s\\S]*?' + scriptClosing, 'gi'), "");
  
  html = html.replace(/\\//g, '/');
  
  container.innerHTML = html;
  
  if(styleContent) { 
    let styleEl = document.createElement('style'); 
    styleEl.textContent = styleContent; 
    container.appendChild(styleEl);
  }
  
  if(scriptContent) { 
    let scriptEl = document.createElement('script'); 
    scriptEl.textContent = scriptContent; 
    container.appendChild(scriptEl);
  }
}

function countElements(html) {
  const div = document.createElement('div'); 
  div.innerHTML = html;
  return div.querySelectorAll('*').length;
}

document.addEventListener("DOMContentLoaded", ()=>{
  const setupForm = document.getElementById('setupForm');
  if(setupForm) {
    setupForm.addEventListener('submit', initializeExperience);
  }
  
  document.getElementById('userIntent')?.addEventListener('keydown',(e)=>{
    if(e.key==='Enter'&&e.ctrlKey) generateInterface();
  });
});
</script>
</body>
</html>
