
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Morphic Web ‚Äî AI Agent Workflow</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
<style>
    html, body { 
      height: 100%; 
      overflow-x: hidden;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(122deg, #2435f7 0%, #9e7cea 85%);
      min-height: 100vh;
      background-attachment: fixed;
      color: #182042;
      margin: 0; padding: 0;
    }
    .container {
      max-width: 100vw;
      width: 95%;
      max-width: 700px;
      margin: 32px auto 20px;
      background: rgba(255,255,255,0.90);
      border-radius: 22px;
      box-shadow: 0 12px 36px 0 rgba(60,50,200,0.13);
      padding: 20px;
      backdrop-filter: blur(9px);
      position: relative;
      box-sizing: border-box;
    }
    
    .generated-content {
      margin-top: 12px;
      padding: 14px 10px 20px 10px;
      background: rgba(245,250,255,0.94);
      border-radius: 10px;
      min-height: 78px;
      max-width: 100%;
      overflow-x: auto;
      overflow-y: auto;
      box-sizing: border-box;
      word-wrap: break-word;
    }
    
    .generated-content * {
      max-width: 100% !important;
      box-sizing: border-box !important;
    }
    
    .generated-content div,
    .generated-content #mainAPP,
    .generated-content .mainAPP {
      max-width: 100% !important;
      overflow-x: auto !important;
      word-wrap: break-word !important;
      box-sizing: border-box !important;
    }
    
    .generated-content input,
    .generated-content textarea,
    .generated-content button,
    .generated-content table {
      max-width: 100% !important;
      box-sizing: border-box !important;
    }
    
    .generated-content table {
      width: 100% !important;
      table-layout: fixed !important;
    }

    /* React enhancement section */
    .react-enhancement {
      margin-top: 15px;
      padding: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      color: white;
      text-align: center;
    }
    
    .react-enhancement button {
      background: rgba(255,255,255,0.9);
      color: #667eea;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      margin: 5px;
    }
    
    .react-enhancement button:hover {
      background: white;
    }
    
    .header {text-align:center;margin-bottom:22px;}
    .logo {font-size:2.1em;color:#5857f8;font-weight:900; text-shadow:0 0 12px #dbeafe;}
    .slogan {font-size:1.11em;opacity:.88;color:#4f40b5;margin:11px auto 0;text-align:center;}
    .agent-status {font-size:0.9em;color:#6b7280;margin-top:5px;font-style:italic;}
.setup-card, .interaction-zone {margin-bottom:16px;}
    .api-input-group label{font-size:1.07em;font-weight:700;color:#7b64e7;display:block;margin-bottom:7px;}
    .api-input-group input{
      font-size:1.07em;padding:12px;width:95%;max-width:340px;border:2.1px solid #e3eafe;
      border-radius:11px;outline:none;margin-bottom:6px; background:rgba(255,255,255,0.6);
      box-shadow:0 2px 9px #b6bffb12 inset;
    }
    .api-input-group small{color:#6b7fa7;font-size:0.97em;margin-bottom:7px;display:block;}
    .start-btn {padding:12px 46px;border-radius:10px;font-size:1.07em;font-weight:700;background:linear-gradient(101deg,#524bb5 0%,#a5b4fc 80%);color:#fff;border:none;cursor:pointer;}
    .start-btn:hover{background:#7b64e7;}
    .stats {display:flex;gap:13px;margin-bottom:9px;flex-wrap:wrap;}
    .stat-card {flex:1;min-width:120px;padding:8px 3px;background:linear-gradient(91deg,#8bb2fe 10%,#add2fb 90%);color:#4027ba;border-radius:9px;text-align:center;font-weight:800;box-shadow:0 2px 7px #0001;}
    .stat-card h3{margin:0;font-size:1.15em;}
    .stat-card p{margin:2px 0 0;opacity:.81;font-size:.97em;}
    .user-input-area{margin-bottom:8px;display:flex;gap:9px;flex-wrap:wrap;}
    .user-input-area textarea {
      flex:1;min-width:250px;padding:13px 16px;border-radius:11px;min-height:50px;font-size:1.07em;
      border:2.1px solid #dadcff;background:#fbfbff;box-shadow:0 1.2px 9px #a9aaff10 inset;
      font-weight:600;letter-spacing:.01em;resize:vertical;
    }
    .user-input-area textarea:focus {border-color:#7b64e7;}
    .generate-btn {background:linear-gradient(89deg,#6267eb 12%,#4ee5fd 95%);color:white;border:none;padding:11px 17px;border-radius:11px;font-size:1.1em;font-weight:900;cursor:pointer;}
    .generate-btn:hover {background:#5ec6fb;}
    .loading{text-align:center;padding:10px;color:#7b64e7;font-size:1.11em;}
    .error-message{background:#f84a77;color:#fff;padding:9px 13px;border-radius:7px;margin-top:7px;}
    .branding{text-align:center;font-size:.94em;color:#7476af;margin-top:16px;}
    .history-log{margin-top:9px;padding:6px 8px;background:#f7f8fc;border-radius:8px;max-height:65px;overflow-y:auto;border:1.2px solid #e5e5fd;}
    .history-item{padding:4px 9px 3px 8px;margin-bottom:3px;background:#fff9;border-radius:5px;font-size:1em;border:1px solid #dfdbff;}
    
    @media(max-width:900px){
      .container{width:98%;padding:15px;}
      .stats{flex-direction:column;gap:4px;}
      .user-input-area{flex-direction:column;}
      .user-input-area textarea{min-width:100%;}
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">Morphic Web</div>
    <div class="slogan">AI Agent Workflow - Multi-step reasoning for complex apps</div>
    <div class="agent-status">3-step chain: Architecture ‚Üí Components ‚Üí Logic</div>
  </div>
<div class="setup-card" id="setupCard">
    <form onsubmit="event.preventDefault(); initializeExperience();">
      <div class="api-input-group">
        <label for="apiKey">Groq API Key</label>
        <input type="password" id="apiKey" required autocomplete="off" placeholder="Paste your Groq API key">
        <small>Get a free key from <a href="https://console.groq.com/" target="_blank">console.groq.com</a></small>
      </div>
      <button type="submit" class="start-btn">üîì Start Morphic Web</button>
    </form>
  </div>
  <div style="display:none" class="interaction-zone" id="interactionZone">
    <div class="stats">
      <div class="stat-card"><h3 id="interactionCount">0</h3><p>Interactions</p></div>
      <div class="stat-card"><h3 id="elementsCreated">0</h3><p>Elements Created</p></div>
      <div class="stat-card"><h3 id="adaptations">0</h3><p>Adaptations</p></div>
    </div>
    <div class="user-input-area">
      <textarea id="userIntent" placeholder="Describe your app: game, dashboard, AI tool, etc. Everything will fit perfectly on your screen!"></textarea>
      <button type="button" onclick="generateInterface()" class="generate-btn">‚ú® Generate</button>
    </div>
    <div class="generated-content" id="generatedContent">
      <p style="color:#68a;text-align:center;">Your responsive app will appear here!</p>
    </div>
    <div id="reactEnhancement" style="display:none;" class="react-enhancement">
      <p><strong>‚ú® React Enhancement Available</strong></p>
      <button onclick="enhanceWithReact()">Upgrade to React Version</button>
      <button onclick="keepCurrentVersion()">Keep Current Version</button>
    </div>
    <div class="history-log" id="historyLog"></div>
  </div>
  <div class="branding">Morphic Web &copy; 2026 | Always Responsive</div>
</div>
<script>
let groqKey="", interactionCount=0, elementsCreated=0, adaptations=0, conversationHistory=[];
let currentAppCode = "";

function updateStats() {
  document.getElementById('interactionCount').textContent = interactionCount;
  document.getElementById('elementsCreated').textContent = elementsCreated;
  document.getElementById('adaptations').textContent = adaptations;
}
function logHistory(msg) {
  const log = document.getElementById('historyLog'), item = document.createElement('div');
  item.className = 'history-item'; item.textContent = `${new Date().toLocaleTimeString()} - ${msg}`;
  log.appendChild(item); log.scrollTop = log.scrollHeight;
}
function initializeExperience() {
  groqKey = document.getElementById('apiKey').value.trim();
  if(!groqKey) { alert('Paste your Groq API key!'); return; }
  window.groqKey = groqKey;
  document.getElementById('setupCard').style.display="none";
  document.getElementById('interactionZone').style.display="block";
  logHistory('Responsive session started');
  // Scroll to main content area
  setTimeout(() => {
    document.getElementById('interactionZone').scrollIntoView({ behavior: 'smooth' });
  }, 100);
}
async function generateInterface() {
  const intent=document.getElementById('userIntent').value.trim();
  const content=document.getElementById('generatedContent');
  const reactEnhancement=document.getElementById('reactEnhancement');
  
  if(!intent){alert('Describe what to build!');return;}
  
  content.innerHTML='<div class="loading">‚ö°Ô∏è Creating responsive app...</div>';
  reactEnhancement.style.display = 'none';
  interactionCount++; updateStats();
  
  try {
    // Simplified approach - single step generation
    content.innerHTML='<div class="loading">üéØ Generating complete responsive app...</div>';
    
    const generationPrompt = `CRITICAL: OUTPUT MUST BE PURE HTML/JS/CSS CODE ONLY. NO EXPLANATIONS, NO MARKDOWN, NO CODE BLOCKS.

USER REQUIREMENT: "${intent}"

STRICT REQUIREMENTS:
1. Create a complete, working web application
2. Use semantic HTML elements (div, button, input, form, etc.)
3. Include complete JavaScript for ALL functionality
4. Use inline CSS for styling (NO external dependencies)
5. Make it responsive (mobile-first, max-width: 100%)
6. All interactive elements must work immediately
7. Include proper event handlers (onclick, onchange, onsubmit)
8. Ensure it works perfectly on screens from 320px to 1200px
9. Use flexbox/grid for responsive layout
10. Complete working code - no placeholders

OUTPUT FORMAT:
- Pure HTML with embedded CSS and JavaScript
- NO additional text
- NO markdown
- NO code blocks
- NO explanations

Generate the complete application now:`;
    
    const finalHtml = await callGroqAPI(generationPrompt);
    currentAppCode = finalHtml;
    parseAndInjectHTML(finalHtml, content);
    ensureResponsive();
    
    // Always offer React enhancement for consistency
    reactEnhancement.style.display = 'block';
    
    setTimeout(()=>content.scrollIntoView({behavior:'smooth',block:'center'}), 100);
    conversationHistory.push(intent);
    elementsCreated+=countElements(finalHtml); adaptations++;
    updateStats();
    logHistory(`‚ú® Generated: "${intent.substring(0,45)}..."`);
    document.getElementById('userIntent').value='';
  } catch(e) {
    content.innerHTML=`<div class='error-message'><b>Generation error:</b> ${e.message}</div>`;
    logHistory(`‚ö†Ô∏è ${e.message}`);
  }
}
async function checkForReactEnhancement(intent, currentCode) {
  // Only enhance complex apps that would benefit from React
  const complexPatterns = [
    /calculator|counter|timer|stopwatch/i,
    /todo|list|task|manager/i,
    /game|puzzle|quiz|trivia/i,
    /dashboard|analytics|chart|graph/i,
    /form|survey|questionnaire/i,
    /interactive|dynamic|real.?time/i
  ];
  
  return complexPatterns.some(pattern => pattern.test(intent));
}

async function enhanceWithReact() {
  const content = document.getElementById('generatedContent');
  const reactEnhancement = document.getElementById('reactEnhancement');
  
  content.innerHTML = '<div class="loading">‚ö°Ô∏è Enhancing with React...</div>';
  reactEnhancement.style.display = 'none';
  
  try {
    const enhancementPrompt = `Take this working HTML/CSS/JavaScript app and convert it to use React for better component structure and state management.

CURRENT APP CODE:
${currentAppCode}

REQUIREMENTS FOR REACT CONVERSION:
1. Convert to React functional components using hooks
2. Use proper state management with useState
3. Keep ALL the same functionality and styling
4. Make it responsive (max-width: 100%, mobile-first)
5. Use the existing CSS classes and styles
6. Include proper event handlers
7. Mount the React app to a div with id="react-root"
8. Use React 18 syntax with createRoot
9. Include ALL necessary script tags
10. Make sure it works exactly like the original but with React architecture

Output ONLY the complete React HTML code with no explanations:`;
    
    const reactHtml = await callGroqAPI(enhancementPrompt);
    currentAppCode = reactHtml;
    parseAndInjectHTML(reactHtml, content);
    ensureResponsive();
    
    adaptations++;
    updateStats();
    logHistory('üîÑ Enhanced with React components');
  } catch(e) {
    content.innerHTML = `<div class='error-message'><b>React enhancement failed:</b> ${e.message}</div>`;
    logHistory(`‚ö†Ô∏è React enhancement failed: ${e.message}`);
    // Fall back to original code
    parseAndInjectHTML(currentAppCode, content);
  }
}

function keepCurrentVersion() {
  document.getElementById('reactEnhancement').style.display = 'none';
  logHistory('‚úÖ Kept current version');
}

function ensureResponsive() {
  const content = document.getElementById('generatedContent');
  const allElements = content.querySelectorAll('*');
  
  allElements.forEach(el => {
    if (!el.style.maxWidth) el.style.maxWidth = '100%';
    if (!el.style.boxSizing) el.style.boxSizing = 'border-box';
    
    if (el.tagName === 'TABLE') {
      el.style.width = '100%';
      el.style.tableLayout = 'fixed';
    }
    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
      if (!el.style.width) el.style.width = '100%';
      el.style.maxWidth = '100%';
    }
  });
}

async function callGroqAPI(prompt) {
  const headers = new Headers();
  headers.append('Authorization', `Bearer ${groqKey}`);
  headers.append('Content-Type', 'application/json; charset=utf-8');
  
  const resp = await fetch('https://api.groq.com/openai/v1/chat/completions', {
    method: 'POST',
    headers: headers,
    body: JSON.stringify({
model: 'llama-3.3-70b-versatile',
      max_tokens: 2048, 
      temperature: 0.7,
      messages: [{ role: "user", content: prompt }]
    })
  });
  if(!resp.ok){
    let errorMsg = "Groq API error";
    try { 
      const data = await resp.json(); 
      errorMsg = data.error?.message || errorMsg; 
    } catch(e) {
      console.error("Error parsing error response:", e);
    }
    throw new Error(errorMsg);
  }
  const data = await resp.json();
  let html = "";
  if (data.choices && data.choices[0]?.message?.content) {
    try {
      html = new TextDecoder('utf-8').decode(
        new TextEncoder().encode(data.choices[0].message.content.trim())
      );
    } catch(e) {
      console.error("Encoding error:", e);
      html = data.choices[0].message.content.trim();
    }
  }
// Clean up any markdown or code blocks
  html = html.replace(/```html|```|``````/g,'').trim();
  // Enhanced validation for different response formats
  const hasValidContent = html && (
    /<div/i.test(html) || 
    /<button/i.test(html) ||
    /<input/i.test(html) ||
    /<form/i.test(html) ||
    /<table/i.test(html) ||
    /<canvas/i.test(html)
  );
  
  if(!hasValidContent) {
    console.log("Raw response:", data.choices[0]?.message?.content);
    throw new Error("No usable HTML generated - AI returned invalid format");
  }
return html;
}
function parseAndInjectHTML(raw, container) {
  let html = raw;
  
  // Enhanced validation - check for actual HTML content
  const hasValidHTML = /<(div|button|input|form|table|canvas|svg|img|p|h[1-6])/i.test(html);
  
  if (!hasValidHTML) {
    throw new Error("No valid HTML content detected in AI response");
  }
  
  // Extract and remove style blocks
  const styleMatch = html.match(/<style[^>]*>([\s\S]*?)<\/style>/i);
  const styleContent = styleMatch ? styleMatch[1] : "";
  html = html.replace(/<style[^>]*>[\s\S]*?<\/style>/gi, "");
  
  // Extract and remove script blocks  
  const scriptMatch = html.match(/<script[^>]*>([\s\S]*?)<\/script>/i);
  const scriptContent = scriptMatch ? scriptMatch[1] : "";
  html = html.replace(/<script[^>]*>[\s\S]*?<\/script>/gi, "");
  
  // Clean up any remaining backslash escapes
  html = html.replace(/\\\//g, '/');
  
  // Final validation
  if (!html.trim() || !/<(div|button|input|form|table)/i.test(html)) {
    throw new Error("AI response contains no usable HTML interface elements");
  }
  
  container.innerHTML = html;
  
  // Add style if exists
  if(styleContent) { 
    let styleEl = document.createElement('style'); 
    styleEl.textContent = styleContent; 
    container.appendChild(styleEl);
  }
  
  // Add script if exists
  if(scriptContent) { 
    let scriptEl = document.createElement('script'); 
    scriptEl.textContent = scriptContent; 
    container.appendChild(scriptEl);
  }
  
  // Ensure responsive behavior
  setTimeout(() => {
    ensureResponsive();
  }, 100);
}
function countElements(html) {
  const div = document.createElement('div'); 
  div.innerHTML = html;
  return div.querySelectorAll('*').length;
}

document.addEventListener("DOMContentLoaded", ()=>{
  document.getElementById('userIntent')?.addEventListener('keydown',(e)=>{
    if(e.key==='Enter'&&e.ctrlKey) generateInterface();
  });
});
</script>
</body>
</html>
