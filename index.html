<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Morphic Web - AI Interface Generator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 800px;
    }

    .setup-card, .generation-area {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .generation-area {
      display: none;
    }

    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 2.5em;
      text-align: center;
    }

    .subtitle {
      color: #666;
      text-align: center;
      margin-bottom: 30px;
      font-size: 1.1em;
    }

    .api-input-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 600;
    }

    input[type="text"], input[type="password"], textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    textarea {
      min-height: 100px;
      resize: vertical;
      font-family: inherit;
    }

    .start-btn, .generate-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 10px;
    }

    .start-btn:hover, .generate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    .stats-bar {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-item {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-label {
      font-size: 0.9em;
      color: #666;
      margin-bottom: 5px;
    }

    .stat-value {
      font-size: 1.5em;
      font-weight: bold;
      color: #667eea;
    }

    #previewArea {
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      min-height: 300px;
      padding: 20px;
      margin-top: 20px;
      background: #fafafa;
    }

    .history-panel {
      margin-top: 20px;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 10px;
      max-height: 200px;
      overflow-y: auto;
    }

    .history-item {
      padding: 8px;
      margin-bottom: 5px;
      background: white;
      border-radius: 5px;
      font-size: 0.9em;
      color: #666;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #667eea;
      font-size: 1.2em;
    }

    .react-prompt-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .react-prompt-box {
      background: white;
      padding: 40px;
      border-radius: 20px;
      max-width: 500px;
      text-align: center;
    }

    .react-prompt-box h2 {
      color: #667eea;
      margin-bottom: 20px;
    }

    .react-prompt-box button {
      margin: 10px;
      padding: 12px 30px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .react-prompt-box button:first-of-type {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .react-prompt-box button:last-of-type {
      background: #e0e0e0;
      color: #333;
    }

    .react-prompt-box button:hover {
      transform: scale(1.05);
    }

    @media (max-width: 600px) {
      .stats-bar {
        grid-template-columns: 1fr;
      }
      
      h1 {
        font-size: 2em;
      }
      
      .setup-card, .generation-area {
        padding: 25px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Setup Screen -->
    <div class="setup-card" id="setupCard">
      <h1>üåê Morphic Web</h1>
      <p class="subtitle">AI-Powered Interface Generator</p>
      
      <form id="setupForm">
        <div class="api-input-group">
          <label for="apiKey">Groq API Key</label>
          <input 
            type="password" 
            id="apiKey" 
            placeholder="Enter your Groq API key"
            required
          >
        </div>
        
        <button type="submit" class="start-btn">üîì Start Morphic Web</button>
      </form>
    </div>

    <!-- Generation Area -->
    <div class="generation-area" id="generationArea">
      <h1>‚ú® Create Anything</h1>
      
      <div class="stats-bar">
        <div class="stat-item">
          <div class="stat-label">Generations</div>
          <div class="stat-value" id="genCount">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Elements</div>
          <div class="stat-value" id="elemCount">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">React Ready</div>
          <div class="stat-value" id="reactStatus">‚ùå</div>
        </div>
      </div>

      <div class="api-input-group">
        <label for="promptInput">What do you want to create?</label>
        <textarea 
          id="promptInput" 
          placeholder="Describe anything... a game, a tool, an app, an animation..."
        ></textarea>
      </div>

      <button type="button" onclick="generateInterface()" class="generate-btn">‚ú® Generate</button>

      <div id="previewArea"></div>

      <div class="history-panel" id="historyPanel"></div>
    </div>
  </div>

  <!-- React Enhancement Prompt -->
  <div class="react-prompt-overlay" id="reactPrompt">
    <div class="react-prompt-box">
      <h2>üöÄ React Enhancement Available!</h2>
      <p>Your creation has enough complexity to benefit from React. Would you like to upgrade it?</p>
      <button onclick="enhanceWithReact()">Upgrade to React Version</button>
      <button onclick="keepCurrentVersion()">Keep Current Version</button>
    </div>
  </div>

  <script>
    let userApiKey = '';
    let generationCount = 0;
    let currentHTML = '';
    let history = [];

    // Stats updates
    function updateStats() {
      document.getElementById('genCount').textContent = generationCount;
      document.getElementById('elemCount').textContent = countElements(currentHTML);
    }

    function logHistory(prompt) {
      const timestamp = new Date().toLocaleTimeString();
      history.unshift({ prompt, timestamp });
      
      const historyPanel = document.getElementById('historyPanel');
      historyPanel.innerHTML = history.slice(0, 5).map(h => 
        `<div class="history-item">${h.timestamp} - ${h.prompt.substring(0, 50)}...</div>`
      ).join('');
    }

    // Initialize Experience - Fixed function
    function initializeExperience(e) {
      e.preventDefault();
      
      const apiKeyInput = document.getElementById('apiKey');
      userApiKey = apiKeyInput.value.trim();
      
      if (!userApiKey) {
        alert('Please enter your Groq API key');
        return;
      }
      
      // Hide setup card and show generation area
      document.getElementById('setupCard').style.display = 'none';
      document.getElementById('generationArea').style.display = 'block';
    }

    // Generate Interface
    async function generateInterface() {
      const prompt = document.getElementById('promptInput').value.trim();
      
      if (!prompt) {
        alert('Please describe what you want to create');
        return;
      }

      const previewArea = document.getElementById('previewArea');
      previewArea.innerHTML = '<div class="loading">‚ú® Generating your creation...</div>';

      try {
        const htmlContent = await callGroqAPI(prompt);
        currentHTML = htmlContent;
        generationCount++;
        
        parseAndInjectHTML(htmlContent);
        updateStats();
        logHistory(prompt);
        checkForReactEnhancement();
        
      } catch (error) {
        previewArea.innerHTML = `<div style="color: red; padding: 20px;">Error: ${error.message}</div>`;
      }
    }

    // React Enhancement Check
    function checkForReactEnhancement() {
      const elementCount = countElements(currentHTML);
      const hasInteractivity = /onclick|addEventListener|setState/i.test(currentHTML);
      
      if (elementCount > 15 && hasInteractivity && generationCount >= 2) {
        document.getElementById('reactPrompt').style.display = 'flex';
        document.getElementById('reactStatus').textContent = '‚úÖ';
      }
    }

    async function enhanceWithReact() {
      document.getElementById('reactPrompt').style.display = 'none';
      const previewArea = document.getElementById('previewArea');
      previewArea.innerHTML = '<div class="loading">üöÄ Upgrading to React version...</div>';
      
      const reactPrompt = `Convert this HTML to a React component with hooks and modern practices:

${currentHTML}`;
      
      try {
        const reactVersion = await callGroqAPI(reactPrompt);
        parseAndInjectHTML(reactVersion);
      } catch (error) {
        previewArea.innerHTML = `<div style="color: red;">Enhancement failed: ${error.message}</div>`;
      }
    }

    function keepCurrentVersion() {
      document.getElementById('reactPrompt').style.display = 'none';
    }

    // Responsive check
    function ensureResponsive(html) {
      if (!html.includes('viewport') && !html.includes('@media')) {
        return html.replace('<style>', '<style>
@media (max-width: 768px) { body { padding: 10px; } }');
      }
      return html;
    }

    // Groq API Call
    async function callGroqAPI(prompt) {
      const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${userApiKey}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          model: 'llama-3.1-70b-versatile',
          messages: [{
            role: 'user',
            content: `Create a complete, functional, interactive HTML page for: "${prompt}". Include inline CSS and JavaScript. Make it beautiful, modern, and fully functional. Return ONLY the HTML code, no explanations.`
          }],
          temperature: 0.7,
          max_tokens: 4000
        })
      });

      if (!response.ok) {
        throw new Error(`API Error: ${response.status} - ${response.statusText}`);
      }

      const data = await response.json();
      let html = data.choices[0].message.content;
      
      // Clean markdown code blocks if present
      html = html.replace(/``````
?/g, '');
      
      return ensureResponsive(html);
    }

    // Parse and inject HTML
    function parseAndInjectHTML(html) {
      const previewArea = document.getElementById('previewArea');
      previewArea.innerHTML = '';
      
      const iframe = document.createElement('iframe');
      iframe.style.width = '100%';
      iframe.style.minHeight = '400px';
      iframe.style.border = 'none';
      iframe.style.borderRadius = '10px';
      
      previewArea.appendChild(iframe);
      
      const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
      iframeDoc.open();
      iframeDoc.write(html);
      iframeDoc.close();
      
      // Auto-resize iframe
      setTimeout(() => {
        iframe.style.height = iframeDoc.body.scrollHeight + 'px';
      }, 100);
    }

    // Count elements
    function countElements(html) {
      const matches = html.match(/<[^/][^>]*>/g);
      return matches ? matches.length : 0;
    }

    // Setup form submission - Fixed event listener
    document.addEventListener('DOMContentLoaded', () => {
      const setupForm = document.getElementById('setupForm');
      setupForm.addEventListener('submit', initializeExperience);
    });
  </script>
</body>
</html>
